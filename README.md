# wireguard-server

Данный плейбук настроит VPN-сервер на основе протокола Wireguard. Запуск производится в Docker'е на основе публичного Docker Image'а.
Предполагается, что сервер будет находиться на DigitalOcean.
Для нормальной работы достаточно:

- 1 vCPU
- 1 GB RAM
- 25 GB Disk
- 1 IPv4 WAN IP

*Важно! Версия Ubuntu - 22.04!*

При создании дроплета необходимо выбрать вариант авторизации по ключу и добавить публичный ssh-ключ от машины, с которой планируется запускать ansible playbook.
Также можно добавить и свой локальный ключ, как дополнительный для последующей авторизации на сервере.

## Порядок действий

### Клонировать репозиторий

```bash
git clone https://github.com/skillvrn/wireguard-server.git
cd wireguard-server
```

### Отредактировать необходимые файлы

- Добавить IP-адрес удаленной машины, на которой требуется поднять VPN-сервер в файл `inventory/hosts.yaml`, в директиву `hosts`

В файл `group_vars/all.yaml` записать публичный ssh-ключ от машины, с которой будет запущен плейбук.

- В файле `group_vars/digitalocean.yaml` задать параметры

| Название переменной | Описание переменной |
| --- | --- |
| `wg_user` | Пользователь от которого будет запуск сервера в контейнере |
| `vpn_path` | Рабочая директория |
| `wg_peers_count` | Количество преднастроенных конфигураций для подключения к серверу (конфигурационные файлы и QR-коды) |
| `docker_compose_version` | Версия docker-compose |
| `wg_image` | Образ контейнера |
| `wg_container_name` | Имя для контейнера |
| `wg_internal_subnet` | Подсеть для выдачи IP клиентам и работы в локальной сети |
| `wg_port` | Порт для прослушивания в контейнере и на корневой ВМ |
| `wg_server_url` | Адрес сервера (например, доменное имя) |
| `wg_dns` | DNS сервер, который будет выдан клиентам |
| `wg_puid` | Идентификатор нового пользователя в контейнере |
| `wg_guid` | Идентификатор новой группы в контейнере |

- В файле `ansible.cfg` проверить пользователя, под которым будет происходить подключение к ВМ

### Выполнить команду

```bash
ansible-playbook playbook.yaml
```
