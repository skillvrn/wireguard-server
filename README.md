# wireguard-server

Данный плейбук настроит VPN-сервер на основе протокола Wireguard. Запуск производится в Docker'е на основе публичного Docker Image'а.
Предполагается, что сервер будет находиться на DigitalOcean.
Для нормальной работы достаточно:

- 1 vCPU
- 1 GB RAM
- 25 GB Disk
- 1 IPv4 WAN IP

*Важно! Версия Ubuntu - 22.04!*

При создании дроплета необходимо выбрать вариант авторизации по ключу и добавить публичный ssh-ключ от машины, с которой планируется запускать ansible playbook.
Также можно добавить и свой локальный ключ, как дополнительный для последующей авторизации на сервере.

## Порядок действий

### Клонировать репозиторий

```bash
git clone https://github.com/skillvrn/wireguard-server.git
cd wireguard-server
```

### Отредактировать необходимые файлы

- Добавить IP-адрес удаленной машины, на которой требуется поднять VPN-сервер в файл `inventory/hosts.yaml`, в директиву `hosts`

В файл `group_vars/all.yaml` записать публичный ssh-ключ от машины, с которой будет запущен плейбук.

- В файле `group_vars/digitalocean.yaml` задать параметры
    - `wg_user` - пользователь от которого будет запуск сервера в контейнере
    - `vpn_path` - рабочая директория
    - `wg_peers_count` - количество преднастроенных конфигураций для подключения к серверу (конфигурационные файлы и QR-коды)
    - `docker_compose_version` - версия docker-compose
    - `wg_image` - образ контейнера
    - `wg_container_name` - имя для контейнера
    - `wg_internal_subnet` - подсеть для выдачи IP клиентам и работы в локальной сети

### Выполнить команду

```bash
ansible-playbook playbook.yaml
```

